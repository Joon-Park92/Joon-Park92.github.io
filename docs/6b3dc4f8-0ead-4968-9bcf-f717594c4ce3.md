---
publish: true
id: TSK-250530-123218
uuid: 6b3dc4f8-0ead-4968-9bcf-f717594c4ce3
link: https://chatgpt.com/c/68391be1-a1ec-8009-9125-57d6f1461c40
created: 2025-05-30
---

 ìš”ì²­í•˜ì‹  **Ansibleì„ ì´ìš©í•œ k3s + Helm + ArgoCD ì„¤ì¹˜ í”Œë ˆì´ë¶**ì„ í•œ ë²ˆì— ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” í˜•íƒœë¡œ êµ¬ì„±í•´ë“œë¦´ê²Œìš”.

ğŸ’¡ ëª¨ë“  ì‘ì—…ì„ **ë¡œì»¬ ë¨¸ì‹ ** ë˜ëŠ” **ì›ê²© ì„œë²„** ëª¨ë‘ì—ì„œ ê°€ëŠ¥í•˜ê²Œ ì„¤ê³„í–ˆìŠµë‹ˆë‹¤.

---

## âœ… ì „ì²´ ë””ë ‰í† ë¦¬ êµ¬ì¡° (ìµœì†Œ)

```
ansible-k3s-gitops/
â”œâ”€â”€ inventory/
â”‚   â””â”€â”€ hosts.yml
â”œâ”€â”€ playbooks/
â”‚   â””â”€â”€ setup.yml
â”œâ”€â”€ roles/
â”‚   â”œâ”€â”€ k3s/
â”‚   â”œâ”€â”€ helm/
â”‚   â””â”€â”€ argocd/
```

---

## ğŸ“„ inventory/hosts.yml (ë¡œì»¬ì—ì„œ ì‹¤í–‰í•  ê²½ìš°)

```yaml
all:
  hosts:
    localhost:
      ansible_connection: local
```

---

## ğŸ“„ playbooks/setup.yml

- become: sudo ì²˜ëŸ¼ ë£¨íŠ¸ ê¶Œí•œ ìƒìŠ¹
- roles: ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ì‘ì—… ë¬¶ìŒ

```yaml
- name: Install k3s + helm + ArgoCD
  hosts: localhost
  become: true
  roles:
    - k3s
    - helm
    - argocd
```

---

## ğŸ“„ roles/k3s/tasks/main.yml

```yaml
- name: Install k3s
  shell: curl -sfL https://get.k3s.io | sh -
  args:
    creates: /usr/local/bin/k3s

- name: Ensure kubeconfig is copied to ~/.kube/config
  copy:
    src: /etc/rancher/k3s/k3s.yaml
    dest: /home/{{ ansible_user_id }}/.kube/config
    remote_src: yes
    owner: "{{ ansible_user_id }}"
    group: "{{ ansible_user_id }}"
    mode: '0600'
```

---

## ğŸ“„ roles/helm/tasks/main.yml

```yaml
- name: Install Helm
  shell: |
    curl https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3 | bash
  args:
    creates: /usr/local/bin/helm
```

---

## ğŸ“„ roles/argocd/tasks/main.yml

```yaml
- name: Create namespace for ArgoCD
  kubernetes.core.k8s:
    api_version: v1
    kind: Namespace
    name: argocd
    state: present

- name: Apply ArgoCD manifests
  shell: |
    kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml
  args:
    creates: /var/lib/rancher/k3s/server/manifests/argocd-install.yaml
```

> í•„ìš” ì‹œ `kubectl wait`ì´ë‚˜ `port-forward`, admin password í™•ì¸ë„ ì¶”ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.

---

## â–¶ï¸ ì‹¤í–‰

```bash
ansible-playbook -i inventory/hosts.yml playbooks/setup.yml
```

---

## âœ… ì„¤ì¹˜ í›„ í™•ì¸

```bash
kubectl get nodes
kubectl get pods -n argocd
helm version
```

---

## ğŸ“¦ ë³´ì™„ ê°€ëŠ¥ í•­ëª©

- ArgoCD CLI ì„¤ì¹˜ ë° ë¡œê·¸ì¸ ìë™í™”
- ArgoCD root application ë“±ë¡ ìë™í™”
- `k3s uninstall.sh`ë¡œ ë¡¤ë°± í”Œë ˆì´ë¶ ì‘ì„±
- ë©€í‹°ë…¸ë“œ ì§€ì›ì„ ìœ„í•œ `group_vars/`, `--limit` ì˜µì…˜ êµ¬ì„±

---
