# Debugging in Visual Studio Code

## TL;DR

- `.vscode` 폴더 하위에 `launch.json` 파일에 디버깅 구성을 작성 후 디버거 실행하면 됨

## lanch.json

### **필수 속성**

| 속성          | 설명                                                                                           |
|---------------|------------------------------------------------------------------------------------------------|
| **type**      | 디버깅 구성을 위한 디버거 유형. 설치된 디버깅 확장 프로그램에 따라 달라짐. <br>예: `node`(Node.js), `php`, `go`. |
| **request**   | 디버깅 요청 유형. `launch`(새 프로그램 실행) 또는 `attach`(이미 실행 중인 프로세스에 연결) 지원.                  |
| **name**      | 디버깅 구성 드롭다운 메뉴에 표시될 사용자 친화적인 이름.                                           |

### **모든 디버깅 구성에서 사용 가능한 선택적 속성**

| 속성                   | 설명                                                                                              |
|------------------------|---------------------------------------------------------------------------------------------------|
| **presentation**       | `order`, `group`, `hidden` 속성을 사용해 디버깅 구성 드롭다운 및 빠른 선택 메뉴에서 정렬, 그룹화, 숨김 설정. |
| **preLaunchTask**      | 디버깅 세션 시작 전에 실행할 작업을 설정. <br>예: `tasks.json`의 작업 레이블 또는 `${defaultBuildTask}`. |
| **postDebugTask**      | 디버깅 세션 종료 후 실행할 작업을 설정. <br>예: `tasks.json`의 작업 이름.                          |
| **internalConsoleOptions** | 디버깅 세션 중 **Debug Console** 패널의 가시성을 제어.                                                  |
| **debugServer**        | 디버그 확장 프로그램 개발자 전용 속성. 특정 포트로 디버거 어댑터에 연결하도록 설정.                           |
| **serverReadyAction**  | 디버깅 중 프로그램이 콘솔이나 터미널에 특정 메시지를 출력하면 웹 브라우저에서 URL을 자동으로 열도록 설정.             |

### **다수 디버거에서 지원하는 속성**

| 속성           | 설명                                                                                                   |
|----------------|--------------------------------------------------------------------------------------------------------|
| **program**    | 디버거 실행 시 실행할 파일이나 스크립트 경로.                                                               |
| **args**       | 디버깅 대상 프로그램에 전달할 **인자 목록**. <br>예: `["--port", "8080"]`.                                |
| **env**        | 환경 변수 설정. 변수 값을 `null`로 설정하면 해당 변수를 "제거".                                              |
| **envFile**    | 환경 변수 설정이 포함된 `.env` 파일 경로.                                                                  |
| **cwd**        | 현재 작업 디렉토리. 디펜던시 및 파일 검색 경로에 영향을 미침.                                                |
| **port**       | 실행 중인 프로세스에 연결할 때 사용할 디버깅 포트 번호.                                                     |
| **stopOnEntry**| 프로그램 시작 시 즉시 멈춤. 초기 상태에서 디버깅을 시작해야 할 때 유용.                                          |
| **console**    | 사용할 콘솔 유형. <br>예: `internalConsole`(내장 콘솔), `integratedTerminal`(통합 터미널), `externalTerminal`(외부 터미널). |

### Example: Python Flask App

```json
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Python: With Environment Variables",
      "type": "python",
      "request": "launch",
      "program": "${workspaceFolder}/app.py",
      "env": {
        "FLASK_ENV": "development",
        "DEBUG": "1"
      },
      "console": "integratedTerminal",
      "cwd": "${workspaceFolder}"
    }
  ]
}
```

## Attach vs Launch

- `launch`와 `attach`는 VS Code에서 디버깅할 때 사용하는 **두 가지 주요 모드**로, 디버거가 프로그램과 어떻게 상호작용하는지를 결정

### 1. **Launch 모드**

- **VS Code가 프로그램을 직접 실행하고 디버그**
- 디버거가 **프로세스의 시작 단계부터 관리**
- 개발자가 **앱 실행부터 디버깅까지 모두 VS Code 내에서** 관리하고자 할 때 유용

#### **사용 사례**

- 서버, 데스크톱 앱, CLI 도구를 개발할 때, VS Code에서 프로그램을 실행하며 디버깅하고 싶을 때.
- 예를 들어:
    - Go 프로그램, Python 스크립트, Node.js 서버를 VS Code에서 직접 실행.
    - 브라우저를 열 필요 없이, 브라우저 없는 환경에서 동작하는 앱.

#### **구성 방식**

- `launch.json` 파일에 디버깅 대상의 **실행 경로**와 환경 설정을 작성

```json
{
  "type": "node",
  "request": "launch",
  "name": "Launch Program",
  "program": "${workspaceFolder}/app.js" // 실행 파일 경로
}
```

#### **동작 방식**

1. VS Code가 앱 실행 명령을 내림
2. 앱은 디버그 모드로 시작됨
3. 디버거가 처음부터 앱의 모든 동작을 추적

### 2. **Attach 모드**

- **이미 실행 중인 앱**이나 **외부에서 실행된 프로세스에 VS Code 디버거를 연결**
- 디버거는 프로그램이 실행 중일 때 **중단점 설정, 변수 추적** 등 디버깅 작업만 수행
- **프로세스를 실행하지 않음**

#### **사용 사례**

- 브라우저나 다른 환경에서 이미 실행 중인 앱 디버깅.
- 서버, 컨테이너, 또는 리모트 머신에서 실행 중인 앱에 디버거를 연결하고 싶을 때.
- 예를 들어:
    - 브라우저에서 실행 중인 웹 앱의 JavaScript를 디버깅.
    - Docker 컨테이너에서 실행 중인 Node.js 서버를 디버깅.

#### **구성 방식**

`launch.json` 파일에 실행 중인 프로세스의 디버깅 포트와 연결 정보를 작성

```json
{
  "type": "node",
  "request": "attach",
  "name": "Attach to Process",
  "port": 9229, // 디버깅 포트
  "address": "localhost"
}
```

#### **동작 방식**

1. 앱은 이미 실행 중이어야 함.
2. 디버거가 지정된 포트나 프로세스에 연결.
3. 디버깅 작업(중단점 설정, 변수 추적)을 진행.

### 3. **차이점 요약**

| **특징**         | **Launch 모드**                                              | **Attach 모드**                                   |
|-------------------|-------------------------------------------------------------|--------------------------------------------------|
| **프로세스 실행** | VS Code가 직접 프로그램을 실행.                              | 이미 실행 중인 프로그램에 디버거를 연결.         |
| **사용 대상**     | 새로 실행할 앱을 디버깅.                                      | 외부에서 실행 중인 앱이나 리모트 프로세스 디버깅. |
| **설정 요구사항** | 실행 파일 경로, 환경 변수 등.                                 | 디버깅 포트, 프로세스 ID 또는 네트워크 주소.      |
| **예시**          | Node.js 앱, Python 스크립트, Go 서버 디버깅.                  | 브라우저 탭, Docker 컨테이너, 원격 서버 디버깅.   |

### 4. **실제 예제**

#### **Launch 모드: Node.js 앱 실행 및 디버깅**

- VS Code에서 Node.js 앱 실행 후 디버깅.

```json
{
  "type": "node",
  "request": "launch",
  "name": "Launch Node.js App",
  "program": "${workspaceFolder}/server.js"
}
```

#### **Attach 모드: Docker 컨테이너에서 실행 중인 Node.js 서버 디버깅**

- Docker 컨테이너 내에서 실행 중인 Node.js 서버에 연결.

```json
{
  "type": "node",
  "request": "attach",
  "name": "Attach to Node.js in Docker",
  "port": 9229,
  "address": "localhost",
  "localRoot": "${workspaceFolder}",
  "remoteRoot": "/usr/src/app" // 컨테이너 내 경로
}
```

### 5. **브라우저 개발 vs 서버 개발에서의 차이**

- **브라우저 개발자**:
    - 이미 브라우저에서 실행 중인 앱에 DevTools처럼 연결하는 방식(`attach`)이 익숙.
    - 브라우저의 디버깅 포트(예: 9222)로 연결.
- **서버/데스크톱 개발자**:
    - 프로그램을 편집기에서 실행(`launch`)하며 디버거와 함께 시작하는 워크플로를 선호.
